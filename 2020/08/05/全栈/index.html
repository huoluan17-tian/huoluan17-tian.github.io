<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		全栈 | 
	 
	Hexo
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	
  

	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">


	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@1.3.10/dist/Valine.min.js"></script>

	
	
		<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
	<header id="header">
    <a id="title" href="/" class="logo">Hexo</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">ABOUT</a>
		</li>
		
		<li class="menu-item">
			<a href="https://github.com/wujun234/uid-generator-spring-boot-starter" class="menu-item-link" target="_blank">
				UidGenerator
			</a>
		</li>
		<li class="menu-item">
			<a href="https://github.com/wujun234" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="text" placeholder="search...">
		<div id="tree">
			

			
							<ul>
								<li class="file">
									<a href="/2020/07/28/Vue/">
										Vue
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/01/Vuex/">
										Vuex
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/04/java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">
										java网络编程
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/11/java%E9%83%A8%E5%88%86%E8%A7%A3%E6%9E%90/">
										java部分解析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/09/js%E5%9F%BA%E7%A1%80/">
										js基础
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/2020/08/05/%E5%85%A8%E6%A0%88/">
										全栈
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/10/%E5%AE%9E%E6%88%98%E9%A1%B9%E7%9B%AE%E4%B8%80%E9%9F%B3%E4%B9%90%E8%AF%84%E8%AE%BA%E5%88%86%E6%9E%90/">
										实战项目一音乐评论分析
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/03/%E6%95%B0%E6%8D%AE%E7%AE%97%E6%B3%95%E4%B8%8E%E7%BB%93%E6%9E%84/">
										数据算法与结构
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2020/08/03/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%85%A5%E9%97%A8/">
										正则表达式入门
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">

	全栈
</h1>
<div class="article-meta">
	
	<span>John Doe</span>
	<span>2020-08-05 15:43:39</span>
    
		<div id="article-categories">
            
		</div>
    
</div>

<div id="article-content">
	<h2 id="第一章-Spring-入门"><a href="#第一章-Spring-入门" class="headerlink" title="第一章  Spring 入门"></a>第一章  Spring 入门</h2><h3 id="1-1为什么要学spring"><a href="#1-1为什么要学spring" class="headerlink" title="1.1为什么要学spring"></a>1.1为什么要学spring</h3><p>spring是java语言中必须要掌握的框架，它涵盖了java的各个领域，基本上是全能的。</p>
<p>spring的核心是依赖注入（DI）,spring所有的技术方案都是基于DI发展来的。</p>
<h3 id="1-2-maven入门（上）"><a href="#1-2-maven入门（上）" class="headerlink" title="1.2 maven入门（上）"></a>1.2 maven入门（上）</h3><p>maven:一个项目管理和自动化工具<br><img src="https://style.youkeda.com/img/ham/course/j4/mvn.svg" alt=""><br>注：如果说spring是java必须要学习的框架，那么maven就是必须要掌握的自动化工具。<br>借助maven的中央仓库，我们可以把任意代码分享给别人</p>
<p>maven使用惯例优于配置的原则，在没有要求定制之前，所有项目都遵循以下结构，如果代码放错位置将无法正确运行</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">目录                      目的</span><br><span class="line"><span class="variable">$&#123;basedir&#125;</span>                存放pom.xml和所有子目录</span><br><span class="line"><span class="variable">$&#123;basedir&#125;</span>/pom.xml        maven 项目的配置文件</span><br><span class="line"><span class="variable">$&#123;basedir&#125;</span>/src/main/java  项目java的源代码</span><br><span class="line"><span class="variable">$&#123;basedir&#125;</span>/src/main/resources 项目的资源</span><br><span class="line"><span class="variable">$&#123;basedir&#125;</span>/src/<span class="built_in">test</span>/java    项目的测试类</span><br><span class="line"><span class="variable">$&#123;basedir&#125;</span>/src/<span class="built_in">test</span>/resources 测试使用的资源</span><br></pre></td></tr></table></figure>

<p>maven 安装<br>可以参考网上的安装教程<br>maven命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mvn clean compile   //编译命令 扫描java的源码并完成编译，完成后在根目录下生产target文件</span><br><span class="line">mvn clean package   //编译并打包命令  先编译然后把所有的java文件和资源打包为java的一个压缩格式jar</span><br><span class="line">mvn clean install   //执行安装命令   先编译然后打包最后安装到本都的maven仓库目录中</span><br><span class="line">mvn compile <span class="built_in">exec</span>:java -Dexec.mainClass=<span class="variable">$&#123;main&#125;</span> //先编译然后再执行某一个类的命令 <span class="variable">$&#123;main&#125;</span>是一个变量 类名</span><br></pre></td></tr></table></figure>

<h3 id="1-3maven入门（中）"><a href="#1-3maven入门（中）" class="headerlink" title="1.3maven入门（中）"></a>1.3maven入门（中）</h3><p><img src="https://style.youkeda.com/img/ham/course/j4/Maven%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5.png" alt=""><br>上图的5个概念都会运用到maven的配置文件 pom.xml中</p>
<p>POM:project object model<br>一个项目的所有配置都放在pom文件中，主要包括：定义项目的类型和名字<br>                                     管理依赖关系<br>                                     定制插件</p>
<p>maven坐标：必须指定，表示这个maven工程部署再maven仓库的文件位置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;groupId&gt;com.youkeda.course&lt;/groupId&gt;  //像一个文件夹，一般都要命名</span><br><span class="line">&lt;artifactId&gt;app&lt;/artifactId&gt;           //类似于文件，不能使用中文和特殊字符</span><br><span class="line">&lt;packaging&gt;jar&lt;/packaging&gt;             //打包成的文件工程 一般默认jar 也可以是war ear pom</span><br><span class="line">&lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;        //版本号，后面加SNAPSHOT表示不稳定，随时可以修改 不加或者加RELEASE表示稳定</span><br><span class="line">                                       版本号一般从1.0.0开始 第一位数字表示主版本号 第二位数字表示新增功能次数 第三</span><br><span class="line">                                       位数字表示修复bug的次数  一般数字都不超过100</span><br></pre></td></tr></table></figure>

<p>maven 属性配置：用来做参数设置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">    &lt;java.version&gt;1.8&lt;/java.version&gt;        //表示设置一个参数，它的值是1.8</span><br><span class="line">    &lt;maven.compiler.source&gt;<span class="variable">$&#123;java.version&#125;</span>&lt;/maven.compiler.source&gt; //这个参数表示指定maven编译时源代码的jdk版本</span><br><span class="line">    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;//工程代码源文件的文件编码格式 一般默认utf-8</span><br><span class="line">    &lt;maven.compiler.target&gt;<span class="variable">$&#123;java.version&#125;</span>&lt;/maven.compiler.target&gt; //按照这个值来编译源代码 这是是指1.8</span><br><span class="line">&lt;/properties&gt;</span><br></pre></td></tr></table></figure>

<h3 id="1-4-maven入门（下）"><a href="#1-4-maven入门（下）" class="headerlink" title="1.4 maven入门（下）"></a>1.4 maven入门（下）</h3><p>依赖管理dependencies:用于指定当前工程依赖其他代码库<br>一般我们声明了依赖，会现在本地.m2文件夹内查找文件，没有找到就会去中央仓库下载，下载之后存放在.m2文件内</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;                //可以有多个&lt;dependency&gt; &lt;dependency&gt;标签 内容就是maven坐标</span><br><span class="line">        &lt;groupId&gt;com.alibaba&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;fastjson&lt;/artifactId&gt;</span><br><span class="line">        &lt;version&gt;1.2.62&lt;/version&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure>
<p>一般我们把别人写的叫做三方库，自己和团队写的叫做二方库。</p>
<p>中央仓库：maven会把所有的jar都存放在中央仓库中，我们可以访问阿里云的镜像服务器查看（<a href="https://maven.aliyun.com/mvn/search）" target="_blank" rel="noopener">https://maven.aliyun.com/mvn/search）</a><br>间接依赖：如果一个remote工程依赖了 okhttp 库，而当前工程locale依赖了 remote工程，这个时候locale工程也会自动依赖了 okhttp<br>插件体系plugins:了解插件格式即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;plugins&gt;</span><br><span class="line">        &lt;plugin&gt;                                         //内容也是maven坐标</span><br><span class="line">            &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;</span><br><span class="line">            &lt;artifactId&gt;maven-compiler-plugin&lt;/artifactId&gt;</span><br><span class="line">            &lt;version&gt;3.8.1&lt;/version&gt;</span><br><span class="line">        &lt;/plugin&gt;</span><br><span class="line">    &lt;/plugins&gt;</span><br><span class="line">&lt;/build&gt;</span><br></pre></td></tr></table></figure>
<h3 id="1-5简单实例"><a href="#1-5简单实例" class="headerlink" title="1.5简单实例"></a>1.5简单实例</h3><p>此处略去依赖配置，接口和实现类 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.ApplicationContext;</span><br><span class="line">import org.springframework.context.annotation.AnnotationConfigApplicationContext;</span><br><span class="line">import org.springframework.context.annotation.ComponentScan;</span><br><span class="line">import com.youkeda.service.MessageService;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * Application</span><br><span class="line"> */</span><br><span class="line">@ComponentScan                                   //注解</span><br><span class="line">public class Application &#123;</span><br><span class="line"></span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line"></span><br><span class="line">        ApplicationContext context = new AnnotationConfigApplicationContext(Application.class);  //spring式的面向接口</span><br><span class="line">                                                                                 只关心接口，不关心实现类</span><br><span class="line">        MessageService msgService = context.getBean(MessageService.class);        //spring bean</span><br><span class="line">        System.out.println(msgService.getMessage());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第二章-spring-依赖注入"><a href="#第二章-spring-依赖注入" class="headerlink" title="第二章 spring 依赖注入"></a>第二章 spring 依赖注入</h2><h3 id="2-1-java注解-（annotation）"><a href="#2-1-java注解-（annotation）" class="headerlink" title="2.1 java注解 （annotation）"></a>2.1 java注解 （annotation）</h3><p>例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@Service                               //这个就是注解 </span><br><span class="line">public class MessageServiceImpl implements MessageService&#123;</span><br><span class="line"></span><br><span class="line">    public String <span class="function"><span class="title">getMessage</span></span>() &#123;</span><br><span class="line">         <span class="built_in">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>annotation：它是java推出的一种注释机制，和普通注释不同，他可以可以在编译，运行阶段读取。它也可以看成一个特殊的类，可以完成一些自定义的行为。<br>我们来看看service的源代码来帮助理解注解<br><img src="https://style.youkeda.com/img/ham/course/j4/service1.svg" alt=""><br>可以看出一个注解是由多个注解组合而成的<br>target:它自身也是一个注解，拥有数组属性，用于设定该注解的作用目标范围，因为是数组，所以可以作用多个范围<br>我们来列举几个常用的范围:ElementType.TYPE 表示可以作用于类，接口类，枚举类上<br>                    ElementType.FIFLD 表示可以作用于类的属性上<br>                    ElementType.METHOD表示可以作用于类的方法上<br>                    ElementType.PARAMETER表示可以作用于类的参数<br>例如</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Target(&#123;ElementType.TYPE,ElementType.METHOD&#125;)  //这个表示可以作用于类和方法上</span><br><span class="line"></span><br><span class="line">@Service             //作用于类上</span><br><span class="line">public class MessageServiceImpl implements MessageService&#123;</span><br><span class="line"></span><br><span class="line">    public String <span class="function"><span class="title">getMessage</span></span>() &#123;</span><br><span class="line">         <span class="built_in">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class MessageServiceImpl implements MessageService&#123;</span><br><span class="line"></span><br><span class="line">    @ResponseBody    //作用于方法上</span><br><span class="line">    public String <span class="function"><span class="title">getMessage</span></span>() &#123;</span><br><span class="line">         <span class="built_in">return</span> <span class="string">"Hello World!"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>retention<br>它自身也是一个注解，用于声明该注解的生命周期，即是在编译和运行的哪个阶段有效，它有三个值可以选择<br>             1：SOURCE:纯注释作用<br>             2：CLASS：编译阶段有效<br>             3：RUNTIME:运行时有效<br>例子：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@Retention(RetentionPolicy.RUNTIME) //在运行阶段有效</span><br></pre></td></tr></table></figure>

<p>document<br>它自身也是一个注解，它的作用是将注解中的元素包含到javaDoc文档中，一般都需要添加这个注解。</p>
<p>@interface<br>作用是声明当前的Java类型是注解，固定语法</p>
<p>annotation属性</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">String value() default <span class="string">""</span>;     //String 类型 value名称  </span><br><span class="line">Annotation 的属性有点像类的属性一样，它约定了属性的类型(这个类型是基础类型：String、boolean、int、long)，</span><br><span class="line">和属性名称（默认名称是 value ，在引用的时候可以省略），default 代表的是默认值。</span><br><span class="line"></span><br><span class="line">有了这个属性，我们就可以正式的引用一个 Annotation 啦，比如</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">@Service                 //也可以写成 @Service(value=<span class="string">"Demo"</span>) 或@Service(<span class="string">"Demo"</span>)</span><br><span class="line">public class Demo &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>annotation属性可以有多个<br>例如 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@AliasFor(<span class="string">"name"</span>)   //name表示别名，表示用这个别名 也可以访问到这个属性</span><br><span class="line">    String value() default <span class="string">""</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @AliasFor(<span class="string">"value"</span>)</span><br><span class="line">    String name() default <span class="string">""</span>;</span><br></pre></td></tr></table></figure>

<h3 id="2-2spring-bean"><a href="#2-2spring-bean" class="headerlink" title="2.2spring bean"></a>2.2spring bean</h3><p>Ioc（inversion of control,控制反转）容器是spring框架最核心的组件，没有ioc容器就没有spring框架。它可以减少计算机代码之间的耦合度<br>在spring框架中，通过依赖注入（DI）来实现ioc</p>
<p>在spring的世界中，所有的java对象都被称为bean,构成应用程序主干和由ioc容器管理的对象都被称作beans,beans和它们之间的依赖关系反应在容器<br>配置的元数据中，几乎所有的bean都是由接口+实现类完成的，用户想要获取bean的实例直接从ioc容器获取就可以了，不需要关心实现类。</p>
<p><img src="https://style.youkeda.com/img/ham/course/j4/ioc.svg" alt=""></p>
<p>spring配置元数据的方式有两种： 基于xml<br>                          基于annotation （主流）<br>我们以主流annotation方案来做讲解：<br>我们可以通过一个接口很容易的从ioc容器获得bean对象</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.context.ApplicationContext</span><br></pre></td></tr></table></figure>
<p>annotation类型的ioc容器对应的类是</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.context.annotation.AnnotationConfigApplicationContext</span><br></pre></td></tr></table></figure>
<p>我们在启动java程序之前必须先启动ioc容器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ApplicationContext context = </span><br><span class="line">    new AnnotationConfigApplicationContext(<span class="string">"fm.douban"</span>);  //启动ioc容器，并且加载fm.douban下的bean</span><br><span class="line">                                                            (只要引用了spring注解的类都会被加载)</span><br></pre></td></tr></table></figure>
<p>AnnotationConfigApplicationContext这个类的构造函数有两种<br>                            1AnnotationConfigApplicationContext（String …basePackages）根据包名实例化（常用）<br>                            2AnnotationConfigApplicationContext（Class clazz）根据自定义包名扫描行为实例化</p>
<p>spring bean的注解有以下几种</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.stereotype.Service   //@Service代表 service bean</span><br><span class="line">org.springframework.stereotype.Component //@Component 通用的bean注解 其余三个注解都扩展于Component</span><br><span class="line">org.springframework.stereotype.Controller //@Controller 作用于web bean</span><br><span class="line">org.springframework.stereotype.Repository //@Repository 作用于持久化相关bean</span><br><span class="line">```                        </span><br><span class="line">                            </span><br><span class="line"><span class="comment">### 2.3 spring bean （下）</span></span><br><span class="line">ioc容器可以看成一个大工厂，我们不关心如何生产产品，只需要知道如何使用产品即可</span><br><span class="line">依赖注入第一步是启动ioc容器：（ApplicationContext context = </span><br><span class="line">                     new AnnotationConfigApplicationContext(<span class="string">"fm.douban"</span>);）</span><br><span class="line">      第二步是完成依赖注入行为</span><br><span class="line">依赖注入是一种编程思想，简单来说就是一种获取其他实例的规范</span><br><span class="line"></span><br><span class="line">我们用一个实例来理解依赖注入的方法和作用：在SujectServiceImpl实现类中引入SongService实例，调用方法</span><br><span class="line"> ```bash</span><br><span class="line">不使用依赖注入时的引用</span><br><span class="line">public class SubjectServiceImpl implements SubjectService &#123;</span><br><span class="line"></span><br><span class="line">    private SongService songService;</span><br><span class="line"></span><br><span class="line">    //缓存所有专辑数据</span><br><span class="line">    private static Map&lt;String, Subject&gt; subjectMap = new HashMap&lt;&gt;();</span><br><span class="line">    static &#123;</span><br><span class="line">        Subject subject = new Subject();</span><br><span class="line">        //... 省略初始化数据的过程</span><br><span class="line">        subjectMap.put(subject.getId(), subject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Subject get(String subjectId) &#123;</span><br><span class="line">        Subject subject = subjectMap.get(subjectId);</span><br><span class="line">        //调用 SongService 获取专辑歌曲</span><br><span class="line">        List&lt;Song&gt; songs = songService.list(subjectId);</span><br><span class="line">        subject.setSongs(songs);</span><br><span class="line">        <span class="built_in">return</span> subject;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void setSongService(SongService songService) &#123;           </span><br><span class="line">        this.songService = songService;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用依赖注入时引用</span><br><span class="line">import fm.douban.model.Song;</span><br><span class="line">import fm.douban.model.Subject;</span><br><span class="line">import fm.douban.service.SongService;</span><br><span class="line">import fm.douban.service.SubjectService;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;   //对比2</span><br><span class="line">import org.springframework.stereotype.Service;     //对比1 </span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.List;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@Service                                   //对比1 新增了@Service 注解</span><br><span class="line">public class SubjectServiceImpl implements SubjectService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired                           //对比2   在变量上新增了@Autowired注解</span><br><span class="line">    private SongService songService;</span><br><span class="line"></span><br><span class="line">    //缓存所有专辑数据</span><br><span class="line">    private static Map&lt;String, Subject&gt; subjectMap = new HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    static &#123;</span><br><span class="line">        Subject subject = new Subject();</span><br><span class="line">        subject.setId(<span class="string">"s001"</span>);</span><br><span class="line">        //... 省略初始化数据的过程</span><br><span class="line">        subjectMap.put(subject.getId(), subject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Subject get(String subjectId) &#123;</span><br><span class="line">        Subject subject = subjectMap.get(subjectId);</span><br><span class="line">        //调用 SongService 获取专辑歌曲</span><br><span class="line">        List&lt;Song&gt; songs = songService.list(subjectId);</span><br><span class="line">        subject.setSongs(songs);</span><br><span class="line">        <span class="built_in">return</span> subject;</span><br><span class="line">    &#125;                                                             //对比3 删除了setSongService方法</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>依赖注入总结：依赖注入让我们得到其他bean实例变得十分简单，只需要添加注解就可以了<br>我们渐渐可以发现spring的理论十分复杂，但是它的应用却十分的简单</p>
<h3 id="2-4-spring-resourse（上）"><a href="#2-4-spring-resourse（上）" class="headerlink" title="2.4 spring resourse（上）"></a>2.4 spring resourse（上）</h3><p>我们先来了解一下在java工程中文件的三种情况：1 文件在电脑的某个位置 例如d:/mywork/a.doc<br>                                    2 文件在工程目录下 例如：mywork/toutiao.png<br>                                    3 文件在工程的src/main/resources目录下，我们知道这是maven工程存放文件的地方<br>对于第一第二种情况，我们可以使用file对象直接读写，但是第三种情况file对象读取不到，因为文件已经在jar里了。<br>计算机系统和java系统是有差别的，maven工程编译后会自动去掉src/main/java、src/main/resources 目录</p>
<p>classpath:java内部的文件路径<br>java内部的文件路径指定的文件可以被解析为inputstream对象，可以借助java io读取<br>例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;                                //添加依赖 commons-io库</span><br><span class="line">  &lt;groupId&gt;commons-io&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;commons-io&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;2.6&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">public class Test &#123;</span><br><span class="line"></span><br><span class="line">  public static void main(String[] args) &#123;</span><br><span class="line">    // 读取 classpath 的内容</span><br><span class="line">    InputStream <span class="keyword">in</span> = Test.class.getClassLoader().getResourceAsStream(<span class="string">"data.json"</span>);//经常会用到 代码表示从java的类加载器的实例中</span><br><span class="line">                                                                  查找文件    Test.class表示test.java编译后的 java class文件 </span><br><span class="line">    // 使用 commons-io 库读取文本</span><br><span class="line">    try &#123;</span><br><span class="line">      String content = IOUtils.toString(<span class="keyword">in</span>, <span class="string">"utf-8"</span>);</span><br><span class="line">      System.out.println(content);</span><br><span class="line">    &#125; catch (IOException e) &#123;</span><br><span class="line">      // IOUtils.toString 有可能会抛出异常，需要我们捕获一下</span><br><span class="line">      e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="2-5spring-resource（下）"><a href="#2-5spring-resource（下）" class="headerlink" title="2.5spring resource（下）"></a>2.5spring resource（下）</h3><p>我们都知道spring最擅长的就是封装，spring resource也不例外，它可以把本地文件，classpath文件，远程文件都封装在resource对象里面然后统一加载<br>我们来具体看一下<br>在spring 中定义了一个org.springframework.core.io.Resource类来封装文件，这个类的优势在于它可以支持普通的file，也可以支持class.path文件<br>并且通过org.springframework.core.io.ResourceLoader服务来完成任意文件的读写，你可以在任意的spring bean中引入ResourceLoader</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@Autowired</span><br><span class="line">private ResourceLoader loader;</span><br></pre></td></tr></table></figure>
<p>我们来演示一下spring如何读取文件：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">1 先创建一个接口 fileservice</span><br><span class="line">public interface FileService &#123;</span><br><span class="line"></span><br><span class="line">    String getContent(String name);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">2创建它的实现类</span><br><span class="line">import fm.douban.service.FileService;</span><br><span class="line">import org.apache.commons.io.IOUtils;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.core.io.Resource;            //这个类用来封装文件</span><br><span class="line">import org.springframework.core.io.ResourceLoader;     // 这个类读写文件</span><br><span class="line">import org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.InputStream;</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class FileServiceImpl implements FileService &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private ResourceLoader loader;                  //读写文件</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getContent(String name) &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            InputStream <span class="keyword">in</span> = loader.getResource(name).getInputStream();</span><br><span class="line">            <span class="built_in">return</span> IOUtils.toString(<span class="keyword">in</span>,<span class="string">"utf-8"</span>);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">           <span class="built_in">return</span> null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">3 调用这个接口</span><br><span class="line">FileService fileService = context.getBean(FileService.class);</span><br><span class="line">  String content = fileService.getContent(<span class="string">"classpath:data/urls.txt"</span>);  //读取classpath内的文件</span><br><span class="line">  System.out.println(content);        </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> String content2 = fileService.getContent(<span class="string">"file:mywork/readme.md"</span>);   //读取工程目录下的文件</span><br><span class="line"> System.out.println(content2);       </span><br><span class="line"></span><br><span class="line">String content2 = fileService.getContent(<span class="string">"https://www.zhihu.com/question/34786516/answer/822686390"</span>);//加载远程文件</span><br><span class="line">System.out.println(content2);</span><br></pre></td></tr></table></figure>

<h3 id="2-6-spring-bean-的生命周期"><a href="#2-6-spring-bean-的生命周期" class="headerlink" title="2.6 spring bean 的生命周期"></a>2.6 spring bean 的生命周期</h3><p>spring bean 提供的生命周期管理极大的提高了工程化的能力，更好的管理了bean.<br>什么是生命周期？生命周期是生命从开始到结束的整个流程 状态。<br><img src="https://style.youkeda.com/img/ham/course/j4/beaninstance.svg" alt=""><br>其中init（初始化）方法是我们必须要掌握的，我们以SubjectServiceImpl为例，通过注解来声明init</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import javax.annotation.PostConstruct;       // @PostConstruct 注解的路径</span><br><span class="line"></span><br><span class="line">@Service</span><br><span class="line">public class SubjectServiceImpl implements SubjectService &#123;</span><br><span class="line"></span><br><span class="line">  @PostConstruct                     //使用这个注解就表示这个方法在spring bean 启动后自动执行</span><br><span class="line">  public void <span class="function"><span class="title">init</span></span>()&#123;</span><br><span class="line">      System.out.println(<span class="string">"启动啦"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>有了init方法 我们就可以把静态代码块的内容放在init里面了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">@Service</span><br><span class="line">public class SubjectServiceImpl implements SubjectService &#123;</span><br><span class="line"></span><br><span class="line">  @PostConstruct</span><br><span class="line">  public void <span class="function"><span class="title">init</span></span>()&#123;</span><br><span class="line">      Subject subject = new Subject();</span><br><span class="line">      subject.setId(<span class="string">"s001"</span>);</span><br><span class="line">      subject.setName(<span class="string">"成都"</span>);</span><br><span class="line">      subject.setMusician(<span class="string">"赵雷"</span>);</span><br><span class="line"></span><br><span class="line">      subjectMap.put(subject.getId(), subject);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>小结：spring声明周期可以让我们更轻松的初始化一些行为和维护数据</p>
<h2 id="第三章-spring-mvc"><a href="#第三章-spring-mvc" class="headerlink" title="第三章 spring mvc"></a>第三章 spring mvc</h2><h3 id="3-1-spring-boot介绍"><a href="#3-1-spring-boot介绍" class="headerlink" title="3.1 spring boot介绍"></a>3.1 spring boot介绍</h3><p>spring boot是spring团队打造的一个新的面向服务的框架，它让java web工程的创建 运行和部署变得非常容易，我们必须要掌握<br>spring boot 多了一些工程方案比如下面4点：<br>                    1 java web容器的嵌入集成，默认集成了tomcat服务器，不需要再额外部署<br>                    2 自定义了工程打包格式，通过一个main方法就可以把工程启动<br>                    3 默认集成了你能想到的第三方框架和服务 比如数据库连接<br>                    4 提供了标准的属性配置文件，支持应用的参数动态配置</p>
<p>创建spring boot工程<br>我们可以从官方网站（<a href="https://start.spring.io/）完成创建，" target="_blank" rel="noopener">https://start.spring.io/）完成创建，</a><br>参考视频（<a href="https://qgt-document.oss-cn-beijing.aliyuncs.com/PY1/11/fm%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B.mp4）" target="_blank" rel="noopener">https://qgt-document.oss-cn-beijing.aliyuncs.com/PY1/11/fm%E5%88%9B%E5%BB%BA%E5%B7%A5%E7%A8%8B.mp4）</a><br>注意：创建工程的时候要选择web依赖</p>
<h3 id="3-2-spring-controller入门"><a href="#3-2-spring-controller入门" class="headerlink" title="3.2 spring controller入门"></a>3.2 spring controller入门</h3><p>spring mvc 是java web的一种（说明java web 还是有很多框架的）实现框架<br>java web的规范就是servlet技术，所有的java web 都实现了 servlet api的定义</p>
<p>我们来了解web服务做了哪些事情<br><img src="https://style.youkeda.com/img/ham/course/j4/springmvc1.svg" alt=""><br>我们来理一下流程：当一个网页请求到了服务器之后，然后它就会进入spring boot 应用，最后匹配到一个controller（这也是一个bean）,然后路由到<br>一个具体的bean方法，执行完后返回结果，输出给客户端。<br>可以看出，如果我们能够掌握spring controller就可以自己提供java web 服务了<br>spring controller（控制器）有三个核心点：<br>                              1 bean 的配置：controller注解运用<br>                              2 网络资源的加载：加载网页<br>                              3 网址路由的配置：requestmap 注解运用</p>
<p>1 controller注解<br>spring controller本身也是一个 spring bean,只是多了web能力，所以我们只需要在类上添加一个注解@Controller就可以了</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line">@Controller                              //注意添加注解  一般不需要特意实现接口</span><br><span class="line">public class HelloControl &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2 加载网页<br>在spring boot应用中，网页一般存放在目录src/main/resources/static下<br>controller一般会自动加载static下的html内容，所以创建网站十分简单</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class HelloControl &#123;</span><br><span class="line"></span><br><span class="line">    public String <span class="function"><span class="title">say</span></span>()&#123;       //定义返回的类型为String</span><br><span class="line">        <span class="built_in">return</span> <span class="string">"hello.html"</span>;   //表示自动加载src/main/resources/static/hello.html文件 ，我们只要把hello.html文件写好即可</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line">static子目录 如果hello.html的路径为src/main/resources/static/html/hello.html，</span><br><span class="line">那返回的应该是（<span class="built_in">return</span> <span class="string">"html/hello.html）这样 才能正确加载          </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">RequestMapping注解</span></span><br><span class="line"><span class="string">对于web 服务器来说必须要实现的一个功能就是路由：解析url并提供资源给调用者</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">我们一般把controller类存放在control子包里面</span></span><br><span class="line"><span class="string">配置路由，我们只需要添加一个注解RequestMapping即可</span></span><br><span class="line"><span class="string">```bash</span></span><br><span class="line"><span class="string">import org.springframework.stereotype.Controller;</span></span><br><span class="line"><span class="string">import org.springframework.web.bind.annotation.RequestMapping; //引入注解</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">@Controller                              </span></span><br><span class="line"><span class="string">public class HelloControl &#123;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    @RequestMapping("</span>/hello<span class="string">")            //添加注解</span></span><br><span class="line"><span class="string">    public String say()&#123;</span></span><br><span class="line"><span class="string">        return "</span>html/hello.html<span class="string">";</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#125;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-3-Get-Request（一）"><a href="#3-3-Get-Request（一）" class="headerlink" title="3.3 Get Request（一）"></a>3.3 Get Request（一）</h3><p>我们都知道网络中常用两个协议get 和post 一般我们上网看视频图片都是get协议包括我们上节课学的spring controller也是get协议</p>
<p>通过get协议，我们可以动态的渲染网页，还可以掌握参数的解析，通过获取参数我们可以获取特定的代码逻辑<br>例如<a href="https://www.baidu.com/s?wd=test" target="_blank" rel="noopener">https://www.baidu.com/s?wd=test</a> 可以知道我们在百度中搜索了test<br>我们来看看网址格式<br><img src="https://style.youkeda.com/img/ham/course/j4/url.svg" alt=""><br>url解析非常简单而且重要，url由四个部分组成 协议+域名+路径+参数</p>
<p>获取url 参数<br>每个url都可以设定自定义的参数，就像百度自定义的参数wd一样<br>需求：我们现在以id来作为歌单的参数，那么歌单的url应该是这样的</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">https://域名/songlist?id=xxxx</span><br><span class="line">http://localhost:8080/songlist?id=xxxx  //本地电脑开发的url</span><br></pre></td></tr></table></figure>
<p>定义这个参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.*;  //引入注解 spring mvc的注解都在这个包里面 直接应用</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class SongListControl &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(<span class="string">"/songlist"</span>)</span><br><span class="line">    public String index( @RequestParam(<span class="string">"id"</span>) String id)&#123;   //定义参数十分简单，只需要添加注解即可 </span><br><span class="line">        <span class="built_in">return</span> <span class="string">"html/songList.html"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用这个参数来查找<br>例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class SongListControl &#123;</span><br><span class="line"></span><br><span class="line">    @RequestMapping(<span class="string">"/songlist"</span>)</span><br><span class="line">    public String index( @RequestParam(<span class="string">"id"</span>) String id )&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">"38672180"</span>.equals(id)) &#123;    //如果有这个参数,就返回songList这个界面</span><br><span class="line">          <span class="built_in">return</span> <span class="string">"html/songList.html"</span>;</span><br><span class="line">        &#125;  <span class="keyword">else</span> &#123;</span><br><span class="line">          <span class="built_in">return</span> <span class="string">"html/404.html"</span>;      //没有就返回我们定义的404界面</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>获取多个参数</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class SongListControl &#123;</span><br><span class="line"></span><br><span class="line">  @RequestMapping(<span class="string">"/songlist"</span>)</span><br><span class="line">  public String index(@RequestParam(<span class="string">"id"</span>) String id,  @RequestParam(<span class="string">"pageNum"</span>) int pageNum)&#123;  //添加多个参数即可</span><br><span class="line">     <span class="built_in">return</span> <span class="string">"html/songList.html"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意点：如果设置了多个参数，那么url访问的时候必须要传递这些参数<br>小知识：所有的网站和程序都是通过request请求来搭建的。</p>
<h3 id="3-4-get-request（二）"><a href="#3-4-get-request（二）" class="headerlink" title="3.4 get request（二）"></a>3.4 get request（二）</h3><p>@GetMapping<br>我们在controller那一节学习了@RequestMapping注解来解析url请求路径，这个注解默认支持所有的http method，放开所有的http method这样不是<br>很安全，我们可以用@GetMapping代替@RequestMappin注解。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@GetMapping(<span class="string">"/songlist"</span>)                               //替换掉注解@RequestMapping</span><br><span class="line">public String index(@RequestParam(<span class="string">"id"</span>) String id,@RequestParam(<span class="string">"pageNum"</span>) int pageNum)&#123;</span><br><span class="line">  <span class="built_in">return</span> <span class="string">"html/songList.html"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">我们可以使用下面的url进行访问</span><br><span class="line">http://xxxx/songlist?id=xxx&amp;pageNum=1  //多个参数用&amp;隔开</span><br></pre></td></tr></table></figure>
<p>非必须传递参数<br>如果想要某个参数不是一定要传递，那么我们可以参数修改注解</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(<span class="string">"/songlist"</span>)</span><br><span class="line">public String index(@RequestParam(name=<span class="string">"pageNum"</span>,required = <span class="literal">false</span>) int pageNum,@RequestParam(<span class="string">"id"</span>) String id)&#123;</span><br><span class="line">                                                       //参数名称为pageNum required = <span class="literal">false</span>表示非必须传递</span><br><span class="line">  <span class="built_in">return</span> <span class="string">"html/songList.html"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">我们可以通过下面两种的url进行访问</span><br><span class="line">http://xxxx/songlist?id=xxx&amp;pageNum=1</span><br><span class="line"></span><br><span class="line">http://xxxx/songlist?id=xxx</span><br></pre></td></tr></table></figure>

<p>输出json数据<br>我们上面的例子返回的都是html页面，但现在web通用的数据是json，那我们要如何在spring中配置json数据呢？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(<span class="string">"/api/foos"</span>)</span><br><span class="line">@ResponseBody                                   //添加此注解即可</span><br><span class="line">public String getFoos(@RequestParam(<span class="string">"id"</span>) String id) &#123;</span><br><span class="line">  <span class="built_in">return</span> <span class="string">"ID: "</span> + id;</span><br><span class="line">&#125;</span><br><span class="line">使用以下url进行访问</span><br><span class="line">https://xxxx/api/foos?id=100</span><br></pre></td></tr></table></figure>
<p>小知识:spring mvc会自动的把对象转化为json字符串输出到网页中，我们把这种输出json数据的方法叫做api。</p>
<h2 id="第四章-spring-template-入门"><a href="#第四章-spring-template-入门" class="headerlink" title="第四章 spring template 入门"></a>第四章 spring template 入门</h2><h3 id="4-1-thymeleaf-入门"><a href="#4-1-thymeleaf-入门" class="headerlink" title="4.1 thymeleaf 入门"></a>4.1 thymeleaf 入门</h3><p>它是spring选择的默认模板方案，它可以支持多种格式内容的动态渲染<br>它的原理：数据+模板+引擎渲染出真实的页面<br>例如<br><img src="https://style.youkeda.com/img/ham/course/j4/template1.svg" alt=""></p>
<p>如何初始化thymeleaf?<br>1添加maven依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-thymeleaf&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<p>数据传递<br>因为spring mvc 把页面数据封装的十分完善，我们在方法参数里面引入一个model对象，就可以通过这个model对象传递数据到页面中了。<br>导入这个model类</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.ui.Model;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class SongListControl &#123;</span><br><span class="line"></span><br><span class="line">  @Autowired</span><br><span class="line">  private SongListService songListService;</span><br><span class="line"></span><br><span class="line">  @RequestMapping(<span class="string">"/songlist"</span>)</span><br><span class="line">  public String index(@RequestParam(<span class="string">"id"</span>)String id,Model model)&#123;   //引入一个model对象</span><br><span class="line"></span><br><span class="line">    SongList songList = songListService.get(id);</span><br><span class="line">    //传递歌单对象到模板当中</span><br><span class="line">    //第一个 songList 是模板中使用的变量名</span><br><span class="line">    // 第二个 songList 是当前的对象实例</span><br><span class="line">    model.addAttribute(<span class="string">"songList"</span>,songList);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> <span class="string">"songList"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>模板文件<br>模板文件一般存放在工程的src/main/resources/templates目录下<br>所以上面的return “songList”会去查找src/main/resources/templates/songList.html文件，且自动匹配后缀.html</p>
<p>注意点：只要工程src/main/resources/templates目录下面放置了文件，那么这些文件就是模板，而且表示被使用<br>src/main/resources/static 这个不是模板，是静态文件，如果使用了模板就一定要添加依赖</p>
<h3 id="4-2thymeleaf变量"><a href="#4-2thymeleaf变量" class="headerlink" title="4.2thymeleaf变量"></a>4.2thymeleaf变量</h3><p>thymeleaf模板语法非常强大，它可以看作一个动态编程语言，它支持许多语言的特性，包括 变量 循环条件等。<br>th:text属性是模板自定义的html标签属性，th是thymeleaf的缩写，看到th就表示使用了thymeleaf模板语法。<br>举例：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;span th:text=<span class="string">"<span class="variable">$&#123;msg&#125;</span>"</span>&gt;Hello&lt;/span&gt;   //表示用msg替代了span 标签内的hello内容</span><br><span class="line">&lt;span&gt;msg/span&gt;</span><br></pre></td></tr></table></figure>
<p>注意变量的格式${xxx}</p>
<p>要调用模板的变量需要先设置模板变量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">model.addAttribute(<span class="string">"msg"</span>,str);     // 变量名为msg  赋值为str</span><br><span class="line">model.addAttribute(<span class="string">"songList"</span>,songList);  //变量名为songList  变量值为songList</span><br></pre></td></tr></table></figure>
<p>对象变量<br>我们还可以设置对象变量，然后用.把属性调用出来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">model.addAttribute(<span class="string">"sl"</span>,songList);  //在控制器中 设置变量为sl,变量值为songList对象</span><br><span class="line"></span><br><span class="line"> &lt;span th:text=<span class="string">"<span class="variable">$&#123;sl.id&#125;</span>"</span>&gt;&lt;/span&gt;   //在模板中用.调用对象的属性</span><br><span class="line">    &lt;span th:text=<span class="string">"<span class="variable">$&#123;sl.name&#125;</span>"</span>&gt;&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<h3 id="4-3thymeleaf循环语句"><a href="#4-3thymeleaf循环语句" class="headerlink" title="4.3thymeleaf循环语句"></a>4.3thymeleaf循环语句</h3><p>在thymeleaf模板语法中 th:each 就表示for循环</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul th:each=<span class="string">"song : <span class="variable">$&#123;songs&#125;</span>"</span>&gt;             //<span class="variable">$&#123;songs&#125;</span> 是设置的变量  song是遍历后的每一个对象</span><br><span class="line">  &lt;li th:text=<span class="string">"<span class="variable">$&#123;song.name&#125;</span>"</span>&gt;歌曲名称&lt;/li&gt;   //读取每个歌曲的名称</span><br><span class="line">&lt;/ul&gt;</span><br></pre></td></tr></table></figure>

<p>打印列表的索引值<br>th:each 还有另外一种写法</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;ul th:each=<span class="string">"song,it: <span class="variable">$&#123;songs&#125;</span>"</span>&gt;      //it作为可选参数 需要统计数据的时候可以使用</span><br><span class="line">  &lt;li&gt;</span><br><span class="line">    &lt;span th:text=<span class="string">"<span class="variable">$&#123;it.count&#125;</span>"</span>&gt;&lt;/span&gt;</span><br><span class="line">    &lt;span th:text=<span class="string">"<span class="variable">$&#123;song.name&#125;</span>"</span>&gt;&lt;/span&gt;</span><br><span class="line">  &lt;/li&gt;</span><br><span class="line">&lt;/ul&gt;</span><br><span class="line"></span><br><span class="line">我们来看看it有哪些统计结果</span><br><span class="line">it.index          //从0开始显示行数</span><br><span class="line">it.count          //从1开始显示行数</span><br><span class="line">it.size           //被迭代对象的大小，获取列表长度时可以用</span><br><span class="line">it.current        //表示当前变量，上面等同于song</span><br><span class="line">it.even/odd       //布尔值，当前循环是否时偶数 奇数</span><br><span class="line">it.first          //布尔值，当前循环是否是第一个</span><br><span class="line">it.last           //布尔值，当前循环是否是最后一个</span><br></pre></td></tr></table></figure>

<h3 id="4-4thymeleaf表达式"><a href="#4-4thymeleaf表达式" class="headerlink" title="4.4thymeleaf表达式"></a>4.4thymeleaf表达式</h3><p>thymeleaf对动态数据的处理非常方便，它常用于两种场景：<br>                                            1 字符串处理<br>                                            2 数据转化<br>字符串处理：我们举一个时间的例子</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;span th:text=<span class="string">"'00:00/'+<span class="variable">$&#123;totalTime&#125;</span>"</span>&gt;&lt;/span&gt;  //我们可以使用<span class="string">' '</span>来包住文本 然后使用+连接变量 否则会报错</span><br><span class="line"></span><br><span class="line">&lt;span th:text=<span class="string">"00:00/+<span class="variable">$&#123;totalTime&#125;</span>"</span>&gt;&lt;/span&gt;  //报错</span><br><span class="line"></span><br><span class="line">&lt;span th:text=<span class="string">"|00:00/<span class="variable">$&#123;totalTime&#125;</span>|"</span>&gt;&lt;/span&gt; //也可以使用|包围住字符串</span><br></pre></td></tr></table></figure>
<p>数据转化：<br>thymeleaf默认集成了大量的工具类可以方便的进行数据的转化<br>一般我们使用最多的便是dates，如果想处理LocalDate和LocalDateTime类，可以添加依赖</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.thymeleaf.extras&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;thymeleaf-extras-java8time&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;3.0.4.RELEASE&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">此库会默认添加一个工具类temporals</span><br></pre></td></tr></table></figure>
<p>变量和工具类的表达是不同的，变量使用的是${变量名}，而工具类是用的是#{工具类}</p>
<p>如果是data </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Date dateVar = new Date();  //date型 </span><br><span class="line"></span><br><span class="line">模板中的使用方法</span><br><span class="line">&lt;p th:text=<span class="string">"<span class="variable">$&#123;#dates.format(dateVar, 'yyyy-MM-dd')&#125;</span>"</span>&gt;&lt;/p&gt;   </span><br><span class="line">&lt;p th:text=<span class="string">"<span class="variable">$&#123;#dates.format(dateVar, 'yyyy年MM月dd日')&#125;</span>"</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;p th:text=<span class="string">"<span class="variable">$&#123;#dates.format(dateVar, 'yyyy-MM-dd HH:mm:ss')&#125;</span>"</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;p th:text=<span class="string">"<span class="variable">$&#123;#dates.format(dateVar, 'yyyy年MM月dd日 HH时mm分ss秒')&#125;</span>"</span>&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure>
<p>如果是LocalDate/LocalDateTime</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">LocalDateTime dateVar = LocalDateTime.now();</span><br><span class="line"></span><br><span class="line">&lt;p th:text=<span class="string">"<span class="variable">$&#123;#temporals.format(dateVar, 'yyyy-MM-dd')&#125;</span>"</span>&gt;&lt;/p&gt;</span><br><span class="line">	&lt;p th:text=<span class="string">"<span class="variable">$&#123;#temporals.format(dateVar, 'yyyy年MM月dd日')&#125;</span>"</span>&gt;&lt;/p&gt;</span><br><span class="line"></span><br><span class="line">	&lt;p th:text=<span class="string">"<span class="variable">$&#123;#temporals.format(dateVar, 'yyyy-MM-dd HH:mm:ss')&#125;</span>"</span>&gt;&lt;/p&gt;</span><br><span class="line">	&lt;p th:text=<span class="string">"<span class="variable">$&#123;#temporals.format(dateVar, 'yyyy年MM月dd日 HH时mm分ss秒')&#125;</span>"</span>&gt;&lt;/p&gt;</span><br></pre></td></tr></table></figure>

<p>一些其他的方法：例如#strings</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#strings.toUpperCase(name)&#125;</span>       //把字符串改成全大写</span><br><span class="line"><span class="variable">$&#123;#strings.toLowerCase(name)&#125;</span>       //把字符串改为全小写</span><br><span class="line"><span class="variable">$&#123;#strings.arrayJoin(array,',')&#125;</span>    //把字符串数组拼接为字符串，并以,连接</span><br><span class="line"><span class="variable">$&#123;#strings.arraySplit(str,',')&#125;</span>      //把字符串分隔成一个数组，并以,作为分隔符，比如a,b执行后会变成</span><br><span class="line">                                      [<span class="string">"a"</span>,<span class="string">"b"</span>]；如果abc没有匹配到，执行后会变成[<span class="string">"abc"</span>]</span><br><span class="line"><span class="variable">$&#123;#strings.trim(str)&#125;</span>                //把字符串去空格，左右空格都会去掉</span><br><span class="line"><span class="variable">$&#123;#strings.length(str)&#125;</span>              //得到字符串的长度，也支持获取集合类的长度</span><br><span class="line"><span class="variable">$&#123;#strings.equals(str1,str2)&#125;</span>        //比较两个字符串是否相等</span><br><span class="line"><span class="variable">$&#123;#strings.equalsIgnoreCase(str1,str2)&#125;</span> //忽略大小写后比较两个字符串是否相等</span><br></pre></td></tr></table></figure>
<p>完整的内置对象</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#messages</span></span><br><span class="line"><span class="comment">#urls/uris</span></span><br><span class="line"><span class="comment">#conversions</span></span><br><span class="line"><span class="comment">#dates</span></span><br><span class="line"><span class="comment">#calendars</span></span><br><span class="line"><span class="comment">#numbers</span></span><br><span class="line"><span class="comment">#strings</span></span><br><span class="line"><span class="comment">#objects</span></span><br><span class="line"><span class="comment">#bools</span></span><br><span class="line"><span class="comment">#arrays</span></span><br><span class="line"><span class="comment">#lists</span></span><br><span class="line"><span class="comment">#sets</span></span><br><span class="line"><span class="comment">#maps</span></span><br><span class="line"><span class="comment">#aggregates</span></span><br><span class="line"><span class="comment">#ids</span></span><br></pre></td></tr></table></figure>

<p>内联表达式可以把变量之间写在html中</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span&gt;Hello [[<span class="variable">$&#123;msg&#125;</span>]]&lt;/span&gt;  //[[变量]]这种格式就是内联表达式</span><br></pre></td></tr></table></figure>
<p>th:text和[[]]两种写法都是允许的，看个人习惯</p>
<h3 id="4-5-thymeleaf条件语句"><a href="#4-5-thymeleaf条件语句" class="headerlink" title="4.5 thymeleaf条件语句"></a>4.5 thymeleaf条件语句</h3><p>thymeleaf同样也是支持条件语句if/else的<br>th:if的使用</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span th:<span class="keyword">if</span>=<span class="string">"<span class="variable">$&#123;user.sex == 'male'&#125;</span>"</span>&gt;男&lt;/span&gt; //<span class="keyword">if</span>表达式的值为<span class="literal">true</span>时渲染</span><br></pre></td></tr></table></figure>
<p>th:unless代表的是否定条件，表示unless表达式的false时渲染</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;span th:unless=<span class="string">"<span class="variable">$&#123;user.sex == 'male'&#125;</span>"</span>&gt;女&lt;/span&gt;</span><br></pre></td></tr></table></figure>

<p>thymeleaf对下面的表达式都判定为true</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1值非空</span><br><span class="line">2值是非0数字</span><br><span class="line">3值是字符串但不是<span class="literal">false</span>, off or no</span><br></pre></td></tr></table></figure>

<p>strings逻辑判断<br>我们常常使用#strings来做逻辑判断和数据处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">检验是否为空</span><br><span class="line"><span class="variable">$&#123;#strings.isEmpty(name)&#125;</span>        //检验字符串</span><br><span class="line"><span class="variable">$&#123;#strings.arrayIsEmpty(name)&#125;</span>  //检验数组</span><br><span class="line"><span class="variable">$&#123;#strings.listIsEmpty(name)&#125;</span>    //检验集合类</span><br></pre></td></tr></table></figure>
<p>contains 检查是否含有某个字符串片段</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$&#123;#strings.contains(name,'abc')&#125;</span>                              //检查是否含有abc这个字符串</span><br><span class="line">&lt;p th:<span class="keyword">if</span>=<span class="string">"<span class="variable">$&#123;#strings.contains(str1,'人')&#125;</span>"</span>&gt;匹配到人这个字啦&lt;/p&gt;  //检查是否含有人这个字</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#strings判断语法的其他几个常用方法</span></span><br><span class="line"><span class="variable">$&#123;#strings.containsIgnoreCase(name,'abc')&#125;</span>    //先忽略大小写字母，然后去判断是否包含指定的字符串</span><br><span class="line"><span class="variable">$&#123;#strings.startsWith(name,'abc')&#125;</span>            //判断字符串是不是以 abc 开头的</span><br><span class="line"><span class="variable">$&#123;#strings.endsWith(name,'abc')&#125;</span>              //判断字符串是不是以 abc 结束：：：的</span><br></pre></td></tr></table></figure>

<h2 id="第五章-spring-template进阶"><a href="#第五章-spring-template进阶" class="headerlink" title="第五章 spring template进阶"></a>第五章 spring template进阶</h2><h3 id="5-1-thymeleaf表单"><a href="#5-1-thymeleaf表单" class="headerlink" title="5.1 thymeleaf表单"></a>5.1 thymeleaf表单</h3><p>实例演示：<br>1图书模型</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">public class Book&#123;</span><br><span class="line">  // 主键</span><br><span class="line">  private long id;             //可以使用long类型 这样id更容易搜索，但也更容易被爬取数据</span><br><span class="line">  // 图书的名称</span><br><span class="line">  private String name;</span><br><span class="line">  // 图书的作者</span><br><span class="line">  private String author;</span><br><span class="line">  // 图书的描述</span><br><span class="line">  private String desc;</span><br><span class="line">  // 图书的编号</span><br><span class="line">  private String isbn;</span><br><span class="line">  // 图书的价格</span><br><span class="line">  private double price;</span><br><span class="line">  // 图书的封面图片</span><br><span class="line">  private String pictureUrl;</span><br><span class="line">  // 省略 getter、setter</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>2页面开发 ：我们现在thymeleaf模板里面创建一个名为addBook.html的模板，然后再创建一个BookControl的控制器</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">&lt;form&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;书的名称:&lt;/label&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;书的作者:&lt;/label&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;书的描述:&lt;/label&gt;</span><br><span class="line">    &lt;textarea&gt;&lt;/textarea&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;书的编号:&lt;/label&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;书的价格:&lt;/label&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;label&gt;书的封面:&lt;/label&gt;</span><br><span class="line">    &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> /&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">  &lt;div&gt;</span><br><span class="line">    &lt;button <span class="built_in">type</span>=<span class="string">"submit"</span>&gt;注册&lt;/button&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">配置control</span><br><span class="line">package com.bookstore.control;</span><br><span class="line"></span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.ui.Model;</span><br><span class="line">import org.springframework.web.bind.annotation.*;</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class BookControl &#123;</span><br><span class="line">  // 当页面访问 http://localhost:8080/book/add.html 时</span><br><span class="line">  // 渲染 addBook.html 模板</span><br><span class="line">  @GetMapping(<span class="string">"/book/add.html"</span>)</span><br><span class="line">  public String addBookHtml(Model model)&#123;</span><br><span class="line">    <span class="built_in">return</span> <span class="string">"addBook"</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3 保存书籍  新增一个control来处理保存书籍的逻辑</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@PostMapping(<span class="string">"/book/save"</span>)          //它只接受http method为post请求的数据</span><br><span class="line">  public String saveBook(Book book)&#123;</span><br><span class="line">    books.add(book);               //接受book数据并储存到books对象中</span><br><span class="line">    <span class="built_in">return</span> <span class="string">"saveBookSuccess"</span>;      //返回模板下的saveBookSuccess页面</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">新增一个saveBookSuccess 页面</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span> /&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span> /&gt;</span><br><span class="line">  &lt;title&gt;添加书籍&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h2&gt;添加书籍成功&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>4 form 表单：对html页面需要做一些修改</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=<span class="string">"en"</span>&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=<span class="string">"UTF-8"</span> /&gt;</span><br><span class="line">  &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span> /&gt;</span><br><span class="line">  &lt;meta http-equiv=<span class="string">"X-UA-Compatible"</span> content=<span class="string">"ie=edge"</span> /&gt;</span><br><span class="line">  &lt;title&gt;添加书籍&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h2&gt;添加书籍&lt;/h2&gt;</span><br><span class="line">  &lt;form action=<span class="string">"/book/save"</span> method=<span class="string">"POST"</span>&gt;     // 1 action属性设置为后端的请求路径  method设置为post</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label&gt;书的名称:&lt;/label&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"name"</span>&gt;          //2 input 的name属性后面的值要和模型类book保持一致</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label&gt;书的作者:&lt;/label&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"author"</span>&gt;        //保持一致</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label&gt;书的描述:&lt;/label&gt;</span><br><span class="line">      &lt;textarea name=<span class="string">"desc"</span>&gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label&gt;书的编号:&lt;/label&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"isbn"</span>&gt;        //保持一致</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label&gt;书的价格:&lt;/label&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"price"</span>&gt;      //保持一致</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;label&gt;书的封面:&lt;/label&gt;</span><br><span class="line">      &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> name=<span class="string">"pictureUrl"</span>&gt;   //保持一致</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      &lt;button <span class="built_in">type</span>=<span class="string">"submit"</span>&gt;注册&lt;/button&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-2-spring-validation（一）"><a href="#5-2-spring-validation（一）" class="headerlink" title="5.2 spring validation（一）"></a>5.2 spring validation（一）</h3><p>我们可以借助spring validation来完成表单数据的验证<br>jsr是java规范提案，它向jcp提出新增一个标准化技术规范的请求。<br>jsr380是bean（实例化后的pojo类）验证的规范，下面是它的依赖，都已经自动配置好了，平时不需要我们手动配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;jakarta.validation&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;jakarta.validation-api&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;2.0.1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>validation注解：jsr380的注解可以直接作用到bean的属性上 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">@NotNull          //不允许为 null 对象</span><br><span class="line">@AssertTrue      //是否为 <span class="literal">true</span></span><br><span class="line">@Size            //约定字符串的长度</span><br><span class="line">@Min             //字符串的最小长度</span><br><span class="line">@Max             //字符串的最大长度</span><br><span class="line">@Email           //是否是邮箱格式</span><br><span class="line">@NotEmpty        //不允许为null或者为空，可以用于判断字符串、集合，比如 Map、数组、List    常用</span><br><span class="line">@NotBlank        //不允许为 null 和 空格</span><br></pre></td></tr></table></figure>
<p>示例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">package com.bookstore.model;</span><br><span class="line"></span><br><span class="line">import javax.validation.constraints.*;</span><br><span class="line"></span><br><span class="line">public class User &#123;</span><br><span class="line"></span><br><span class="line">    @NotEmpty(message = <span class="string">"名称不能为 null"</span>)       //注解</span><br><span class="line">    private String name;</span><br><span class="line"></span><br><span class="line">    @Min(value = 18, message = <span class="string">"你的年龄必须大于等于18岁"</span>)</span><br><span class="line">    @Max(value = 150, message = <span class="string">"你的年龄必须小于等于150岁"</span>)  //注解可以不止一条</span><br><span class="line">    private int age;</span><br><span class="line"></span><br><span class="line">    @NotEmpty(message = <span class="string">"邮箱必须输入"</span>)</span><br><span class="line">    @Email(message = <span class="string">"邮箱不正确"</span>)</span><br><span class="line">    private String email;</span><br><span class="line"></span><br><span class="line">    // standard setters and getters </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>完成验证：我们先写好pojo类user ，再创建一个user/addUser.html 模板文件，用于管理员添加成员<br>        然后写一个control完成验证 如下</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">package com.bookstore.control;</span><br><span class="line"></span><br><span class="line">import com.bookstore.model.User;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.validation.BindingResult;   //BindingResult的路径</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line"></span><br><span class="line">import javax.validation.Valid;   //@Valid的路径</span><br><span class="line"></span><br><span class="line">@Controller</span><br><span class="line">public class UserControl &#123;</span><br><span class="line"></span><br><span class="line">    @GetMapping(<span class="string">"/user/add.html"</span>)</span><br><span class="line">    public String <span class="function"><span class="title">addUser</span></span>() &#123;</span><br><span class="line">        <span class="built_in">return</span> <span class="string">"user/addUser"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @PostMapping(<span class="string">"/user/save"</span>)</span><br><span class="line">    public String saveUser(@Valid User user, BindingResult errors) &#123;  //增加两个参数 注意顺序</span><br><span class="line">        <span class="keyword">if</span> (errors.hasErrors()) &#123;</span><br><span class="line">            // 如果校验不通过，返回用户编辑页面</span><br><span class="line">            <span class="built_in">return</span> <span class="string">"user/addUser"</span>;         </span><br><span class="line">        &#125;</span><br><span class="line">        // 校验通过，返回成功页面</span><br><span class="line">        <span class="built_in">return</span> <span class="string">"user/addUserSuccess"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>最后创建一个user/addUserSuccess.html模板文件，用于返回成功页面</p>
<h3 id="5-3-spring-validation（二）"><a href="#5-3-spring-validation（二）" class="headerlink" title="5.3 spring validation（二）"></a>5.3 spring validation（二）</h3><p>如果验证错误怎么把错误结果返回到模板中？要解决上面这个问题，我们需要解决两个关键点。<br>1 如何传递数据？<br>2 如何显示具体的字段错误？</p>
<p>control改造<br>如果我们想显示具体的字段信息，就需要结合模型来传输，例如上节课的user</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@GetMapping(<span class="string">"/user/add.html"</span>)</span><br><span class="line">public String addUser(Model model) &#123;</span><br><span class="line">    User user = new User();           //先创建一个user实例</span><br><span class="line">    model.addAttribute(<span class="string">"user"</span>,user);  //传递到模板中</span><br><span class="line">    <span class="built_in">return</span> <span class="string">"user/addUser"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>user/add/html模板改造，我们取处理错误的状态，增加错误的样式和文案<br>th:object  ：让表单验证状态生效</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action=<span class="string">"/user/save"</span> th:object=<span class="string">"<span class="variable">$&#123;user&#125;</span>"</span> method=<span class="string">"POST"</span>&gt;   //在form标签中新增一个th:object=<span class="string">"<span class="variable">$&#123;user&#125;</span>"</span>属性</span><br><span class="line">                                                          用于替换对象，使用了这个就不需要每次都编写 user.xxx,可以直接操作 xxx</span><br><span class="line">  ...</span><br><span class="line">&lt;/form&gt;</span><br></pre></td></tr></table></figure>
<p>th:classappend ：错误提示</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">必须要现有一个错误的样式</span><br><span class="line">.error &#123;color: red;&#125;</span><br><span class="line"></span><br><span class="line">然后可以使用th:classpath支持动态管理样式</span><br><span class="line">&lt;div th:classappend=<span class="string">"<span class="variable">$&#123;#fields.hasErrors('name')&#125;</span> ? 'error' : ''"</span>&gt;&lt;/div&gt;   //使用了三元表达式 <span class="variable">$&#123;#fields.hasErrors('key')&#125;</span></span><br><span class="line">                                                                         专门为了验证场景而提供，key 就是对象的属性名称，比如User </span><br><span class="line">                                                                          对象的 name、age、email 等</span><br><span class="line">&lt;div class=<span class="string">"error"</span>&gt; &lt;/div&gt;  //上面错误信息含有name之后就会变成此标签</span><br></pre></td></tr></table></figure>

<p>th:errors ：显示错误信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;p th:<span class="keyword">if</span>=<span class="string">"<span class="variable">$&#123;#fields.hasErrors('age')&#125;</span>"</span> th:errors=<span class="string">"*&#123;age&#125;"</span>&gt;&lt;/p&gt;   //th:errors=<span class="string">"*&#123;age&#125;"</span>属性可以自动取出错误信息</span><br></pre></td></tr></table></figure>

<p>th:field :显示上一次输入的内容</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;div th:classappend=<span class="string">"<span class="variable">$&#123;#fields.hasErrors('age')&#125;</span> ? 'error' : ''"</span>&gt;</span><br><span class="line">  &lt;label&gt;年龄:&lt;/label&gt;</span><br><span class="line">  &lt;input <span class="built_in">type</span>=<span class="string">"text"</span> th:field=<span class="string">"*&#123;age&#125;"</span> /&gt;</span><br><span class="line">  &lt;p th:<span class="keyword">if</span>=<span class="string">"<span class="variable">$&#123;#fields.hasErrors('age')&#125;</span>"</span> th:errors=<span class="string">"*&#123;age&#125;"</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<h3 id="5-4-thymeleaf布局-（layout）"><a href="#5-4-thymeleaf布局-（layout）" class="headerlink" title="5.4 thymeleaf布局 （layout）"></a>5.4 thymeleaf布局 （layout）</h3><p>在一个网站里面经常会出现重复的导航底部等内容，我们可以把导航和底部做成布局组件，然后每个页面都套用上<br>使用th:include + th:replace方案可以帮助我们完成布局的开发<br>这个方案很简单分成两步：<br>第一步 ：创建布局组件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns:th=<span class="string">"http://www.thymeleaf.org"</span>&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"UTF-8"</span>&gt;</span><br><span class="line">    &lt;meta name=<span class="string">"viewport"</span> content=<span class="string">"width=device-width, initial-scale=1.0"</span>/&gt;</span><br><span class="line">    &lt;title&gt;布局&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;</span><br><span class="line">        .header &#123;background-color: <span class="comment">#f5f5f5;padding: 20px;&#125;</span></span><br><span class="line">        .header a &#123;padding: 0 20px;&#125;</span><br><span class="line">        .container &#123;padding: 20px;margin:20px auto;&#125;</span><br><span class="line">        .footer &#123;height: 40px;background-color: <span class="comment">#f5f5f5;border-top: 1px solid #ddd;padding: 20px;&#125;</span></span><br><span class="line">    &lt;/style&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;header class=<span class="string">"header"</span>&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;a href=<span class="string">"/book/list.html"</span>&gt;图书管理&lt;/a&gt;</span><br><span class="line">        &lt;a href=<span class="string">"/user/list.html"</span>&gt;用户管理&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/header&gt;                                            //这里是头部组件</span><br><span class="line"></span><br><span class="line">&lt;div class=<span class="string">"container"</span> th:include=<span class="string">"::content"</span>&gt;页面正文内容&lt;/div&gt;    //这里会被替换为正文  ::content选择器，</span><br><span class="line">                                                                     表示加载当前页面的th:fragment的值</span><br><span class="line"></span><br><span class="line"> </span><br><span class="line">&lt;footer class=<span class="string">"footer"</span>&gt;                             //这是底部组件</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;p style=<span class="string">"float: left"</span>&gt;&amp;copy; youkeda.com 2017&lt;/p&gt;</span><br><span class="line">        &lt;p style=<span class="string">"float: right"</span>&gt;</span><br><span class="line">            Powered by 优课达</span><br><span class="line">        &lt;/p&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">&lt;/footer&gt;</span><br><span class="line"></span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure>

<p>第二步 正文内容页面 我们会把组件加在正文上</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html xmlns:th=<span class="string">"http://www.thymeleaf.org"</span></span><br><span class="line">      th:replace=<span class="string">"layout"</span>&gt;                                    //要用的布局的名称 不要写错 这里用的是templates/layout.html</span><br><span class="line">&lt;div th:fragment=<span class="string">"content"</span>&gt;                            //fragment（片段） 就是让上面的选择器选择这个片段  注意和选择器值保持一致</span><br><span class="line">    &lt;h2&gt;用户列表&lt;/h2&gt;</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">        &lt;a href=<span class="string">"/user/add.html"</span>&gt;添加用户&lt;/a&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;table&gt;</span><br><span class="line">        &lt;thead&gt;</span><br><span class="line">        &lt;tr&gt;</span><br><span class="line">            &lt;th&gt;</span><br><span class="line">                用户名称</span><br><span class="line">            &lt;/th&gt;</span><br><span class="line">            &lt;th&gt;</span><br><span class="line">                用户年龄</span><br><span class="line">            &lt;/th&gt;</span><br><span class="line">            &lt;th&gt;</span><br><span class="line">                用户邮箱</span><br><span class="line">            &lt;/th&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;/thead&gt;</span><br><span class="line">        &lt;tbody&gt;</span><br><span class="line">        &lt;tr th:each=<span class="string">"user : <span class="variable">$&#123;users&#125;</span>"</span>&gt;</span><br><span class="line">            &lt;td th:text=<span class="string">"<span class="variable">$&#123;user.name&#125;</span>"</span>&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td th:text=<span class="string">"<span class="variable">$&#123;user.age&#125;</span>"</span>&gt;&lt;/td&gt;</span><br><span class="line">            &lt;td th:text=<span class="string">"<span class="variable">$&#123;user.email&#125;</span>"</span>&gt;&lt;/td&gt;</span><br><span class="line">        &lt;/tr&gt;</span><br><span class="line">        &lt;/tbody&gt;</span><br><span class="line">    &lt;/table&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>
<p>总结一下 即在布局中添加一个选择器，然后在正文中使用这个布局并选择这个选择器</p>
<h2 id="第六章-spring-boot入门"><a href="#第六章-spring-boot入门" class="headerlink" title="第六章 spring boot入门"></a>第六章 spring boot入门</h2><h3 id="6-1-spring-boot-ComponentScan"><a href="#6-1-spring-boot-ComponentScan" class="headerlink" title="6.1 spring  boot ComponentScan"></a>6.1 spring  boot ComponentScan</h3><p>当我们自动注入bean实例的时候，有时候会出现如下报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Field subjectService <span class="keyword">in</span> fm.douban.app.control.SongListControl required a bean of <span class="built_in">type</span></span><br><span class="line"> <span class="string">'fm.douban.service.SubjectService'</span> that could not be found.</span><br></pre></td></tr></table></figure>
<p>这是因为spring 在扫描的时候，只会扫描启动类的包及之下的子包，如果所需要的实例不在启动类的包内就会报错。<br>我们如何来解决这个问题？<br>有两种方法解决这个问题，第一：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@SpringBootApplication(scanBasePackages=&#123;<span class="string">"fm.douban.app"</span>, <span class="string">"fm.douban.service"</span>&#125;) //为启动类的注解添加</span><br><span class="line">                                               一个参数，告诉系统有需要额外扫描的包</span><br></pre></td></tr></table></figure>
<p>第二种：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@ComponentScan(&#123;<span class="string">"fm.service"</span>, <span class="string">"fm.app"</span>&#125;)  //如果不是启动类，可以使用单独的注解@ComponentScan，同样指定需要额外扫描的包</span><br><span class="line">public class SpringConfiguration &#123;</span><br><span class="line">  ... ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>额外知识点：使用@RestController 注解的类，所有的方法都不会渲染thymeleaf模板，而是返回数据。相当于使用@Controller 的类的方法<br>上面加上@ResponseBody 注解</p>
<h3 id="6-2-spring-boot-logger运用"><a href="#6-2-spring-boot-logger运用" class="headerlink" title="6.2 spring boot logger运用"></a>6.2 spring boot logger运用</h3><p>在很多情况下，spring打印出的内容具体输出在什么地方我们是不能确定的，所以我们要使用日志系统。<br>日志系统有两个优势：1日志系统可以轻松的控制日志是否输出<br>                2日志系统可以灵活的设置日志的细节<br>使用日志系统有两大步骤：1 配置<br> 修改spring boot系统的标准配置文件   application.properties  ，增加日志级别配置<br> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">logging.level.root=info      //表示所有的日志root都为info级别       不输出低级别debug的日志信息</span><br><span class="line">logging.level.fm.douban.app=info   //为不同的包定义不同的级别 fm.douban.app 包及其子包中的所有的类都输出 info 级别的日志。</span><br><span class="line">```       </span><br><span class="line">常用的日志级别</span><br><span class="line">```bash</span><br><span class="line">优先级               级别                       含义及作用</span><br><span class="line">最高                 error                     错误日志信息</span><br><span class="line">高                   warn                      暂时不出错，但高风险的警告信息日志</span><br><span class="line">种                   info                      一般的提示语，普通数据等不要紧的信息日志</span><br><span class="line">低                   debug                     开发阶段需要注意的调试信息日志</span><br><span class="line">```    </span><br><span class="line">2 编码：实例化日志对象</span><br><span class="line">```bash</span><br><span class="line">import org.slf4j.Logger;</span><br><span class="line">import org.slf4j.LoggerFactory;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line">import javax.annotation.PostConstruct;</span><br><span class="line"></span><br><span class="line">@RestController</span><br><span class="line">public class SongListControl &#123;</span><br><span class="line">    private static final Logger LOG = LoggerFactory.getLogger(SongListControl.class);  //固定写法，定义一个类变量</span><br><span class="line"></span><br><span class="line">    @PostConstruct</span><br><span class="line">    public void <span class="function"><span class="title">init</span></span>()&#123;</span><br><span class="line">        LOG.info(<span class="string">"SongListControl 启动啦"</span>);                //在参数种输入日志内容，注意保持级别的一致</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">``` </span><br><span class="line"></span><br><span class="line"><span class="comment">### 6.3 spring boot properties</span></span><br><span class="line"></span><br><span class="line">spring boot框架已经有许多配置，但是部分配置还是要我们自己设置，对于一些特定的情况，我们会在application.properties文件中进行配置</span><br><span class="line">配置文件格式，和上节课一样</span><br><span class="line">```bash</span><br><span class="line">配置项名称=配置项值</span><br><span class="line">logging.level.root=info</span><br><span class="line">logging.level.fm.douban.app=info   //等号两边不加空格</span><br><span class="line"></span><br><span class="line">它的一些默认规则：配置项名称能够准确表达意义，作用以及.分隔符</span><br><span class="line">              相同前缀名的配置项名称放在一起</span><br><span class="line">              不同前缀名的配置项之间空一行</span><br></pre></td></tr></table></figure></p>
<p>配置的意义：避免硬编码，解耦<br>把可变的内容从代码中剥离出来，做到在不修改代码的情况下，修改可变或者常变的内容</p>
<p>自定义配置项<br>在application.properties文件中设置自定义配置项</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">song.name=God is a girl   //自定义配置项</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">使用自定义配置项</span><br><span class="line">import org.springframework.beans.factory.annotation.Value;</span><br><span class="line"></span><br><span class="line">public class SongListControl &#123;</span><br><span class="line">    @Value(<span class="string">"<span class="variable">$&#123;song.name&#125;</span>"</span>)                  //使用@Value注解即可</span><br><span class="line">    private String songName; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="第7章-spring-session"><a href="#第7章-spring-session" class="headerlink" title="第7章 spring session"></a>第7章 spring session</h2><h3 id="7-1-cookie"><a href="#7-1-cookie" class="headerlink" title="7.1 cookie"></a>7.1 cookie</h3><p>cookie是网络编程中一种最常用的技术，它主要用来识别用户身份，它是临时放在客户端的<br><img src="https://style.youkeda.com/img/ham/course/j4/j4-7-1.png?_t=1" alt=""><br>cookie有读写两种操作，服务端会返回cookie给客户端，也会读取客户端提交的cookie数据</p>
<p>读cookie:在control类方法中添加一个HttpServletRequest参数，通过request.getCookies()取得cookie数组，然后遍历循环数组。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import javax.servlet.http.Cookie;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line"></span><br><span class="line">@RequestMapping(<span class="string">"/songlist"</span>)</span><br><span class="line">public Map index(HttpServletRequest request) &#123;   //系统会自动传入方法参数所需要的HttpServletRequest 对象</span><br><span class="line">  Map returnData = new HashMap();</span><br><span class="line">  returnData.put(<span class="string">"result"</span>, <span class="string">"this is song list"</span>);</span><br><span class="line">  returnData.put(<span class="string">"author"</span>, songAuthor);</span><br><span class="line"></span><br><span class="line">  Cookie[] cookies = request.getCookies();</span><br><span class="line">  returnData.put(<span class="string">"cookies"</span>, cookies);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> returnData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>使用注解读取cookie<br>如果知道cookie的名字，就可以通过注解直接读取，不需要再遍历数组<br>control 类的方法增加一个 @CookieValue(“xxxx”) String xxxx 参数即可，注意使用时要填入正确的 cookie名字</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.web.bind.annotation.CookieValue;</span><br><span class="line"></span><br><span class="line">@RequestMapping(<span class="string">"/songlist"</span>)</span><br><span class="line">public Map index(@CookieValue(<span class="string">"JSESSIONID"</span>) String jSessionId) &#123;   // 添加一个注解参数 ，填入正确的名字 名字填错了会报错</span><br><span class="line">  Map returnData = new HashMap();</span><br><span class="line">  returnData.put(<span class="string">"result"</span>, <span class="string">"this is song list"</span>);</span><br><span class="line">  returnData.put(<span class="string">"author"</span>, songAuthor);</span><br><span class="line">  returnData.put(<span class="string">"JSESSIONID"</span>, jSessionId);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> returnData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>写cookie<br>control 类的方法增加一个 HttpServletResponse 参数，调用 response.addCookie() 方法添加 Cookie 实例对象即可</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import javax.servlet.http.Cookie;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">@RequestMapping(<span class="string">"/songlist"</span>)</span><br><span class="line">public Map index(HttpServletResponse response) &#123;   //系统会自动传入方法参数所需要的HttpServletResponse对象</span><br><span class="line">  Map returnData = new HashMap();</span><br><span class="line">  returnData.put(<span class="string">"result"</span>, <span class="string">"this is song list"</span>);</span><br><span class="line">  returnData.put(<span class="string">"name"</span>, songName);</span><br><span class="line"></span><br><span class="line">  Cookie cookie = new Cookie(<span class="string">"sessionId"</span>,<span class="string">"CookieTestInfo"</span>);</span><br><span class="line">  // 设置的是 cookie 的域名，就是会在哪个域名下生成 cookie 值</span><br><span class="line">  cookie.setDomain(<span class="string">"youkeda.com"</span>);</span><br><span class="line">  // 是 cookie 的路径，一般就是写到 / ，不会写其他路径的</span><br><span class="line">  cookie.setPath(<span class="string">"/"</span>);</span><br><span class="line">  // 设置cookie 的最大存活时间，-1 代表随浏览器的有效期，也就是浏览器关闭掉，这个 cookie 就失效了。</span><br><span class="line">  cookie.setMaxAge(-1);</span><br><span class="line">  // 设置是否只能服务器修改，浏览器端不能修改，安全有保障</span><br><span class="line">  cookie.setHttpOnly(<span class="literal">false</span>);</span><br><span class="line">  response.addCookie(cookie);</span><br><span class="line"></span><br><span class="line">  returnData.put(<span class="string">"message"</span>, <span class="string">"add cookie successfule"</span>);</span><br><span class="line">  <span class="built_in">return</span> returnData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-2-spring-session-api"><a href="#7-2-spring-session-api" class="headerlink" title="7.2 spring session api"></a>7.2 spring session api</h3><p>cookie是临时放在客户端的，有可能会被拦截或者伪造，所以我们一般用session（服务端）来存放重要的信息（用户id，登录状态等)<br><img src="https://style.youkeda.com/img/ham/course/j4/j4-7-2.png" alt=""><br>使用session会话机制时，Cookie 作为 session id 的载体与客户端通信。上一节课演示代码中，Cookie 中的 JSESSIONID 就是这个作用.<br>JSESSIONID是专门用来纪录用户session的</p>
<p>读操作：<br>与cookie 相似，从 HttpServletRequest 对象中取得 HttpSession 对象，使用的语句是 request.getSession()。<br>但不同的是，返回结果不是数组，是对象。在 attribute 属性中用 key -&gt; value 的形式存储多个数据。<br>假设存储登录信息的数据 key 是 userLoginInfo，那么语句就是 session.getAttribute(“userLoginInfo”)</p>
<p>登录信息类：<br>登录信息实例对象因为要在网络之中传输，就必须实现序列化接口Serializable，不实现的话就会报错</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">演示两个属性</span><br><span class="line">import java.io.Serializable;</span><br><span class="line"></span><br><span class="line">public class UserLoginInfo implements Serializable &#123;</span><br><span class="line">  private String userId;</span><br><span class="line">  private String userName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>读操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line">@RequestMapping(<span class="string">"/songlist"</span>)</span><br><span class="line">public Map index(HttpServletRequest request, HttpServletResponse response) &#123;</span><br><span class="line">  Map returnData = new HashMap();</span><br><span class="line">  returnData.put(<span class="string">"result"</span>, <span class="string">"this is song list"</span>);</span><br><span class="line"></span><br><span class="line">  // 取得 HttpSession 对象</span><br><span class="line">  HttpSession session = request.getSession();</span><br><span class="line">  // 读取登录信息</span><br><span class="line">  UserLoginInfo userLoginInfo = (UserLoginInfo)session.getAttribute(<span class="string">"userLoginInfo"</span>);  //读取信息的方法getAttribute</span><br><span class="line">  <span class="keyword">if</span> (userLoginInfo == null) &#123;</span><br><span class="line">    // 未登录</span><br><span class="line">    returnData.put(<span class="string">"loginInfo"</span>, <span class="string">"not login"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    // 已登录</span><br><span class="line">    returnData.put(<span class="string">"loginInfo"</span>, <span class="string">"already login"</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> returnData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>写操作：<br>登录成功之后，使用setAttribute()方法纪录登录信息到session</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line">import javax.servlet.http.HttpSession;</span><br><span class="line"></span><br><span class="line">@RequestMapping(<span class="string">"/loginmock"</span>)</span><br><span class="line">public Map loginMock(HttpServletRequest request, HttpServletResponse response) &#123;</span><br><span class="line">  Map returnData = new HashMap();</span><br><span class="line"></span><br><span class="line">  // 假设对比用户名和密码成功</span><br><span class="line">  // 仅演示的登录信息对象</span><br><span class="line">  UserLoginInfo userLoginInfo = new UserLoginInfo();</span><br><span class="line">  userLoginInfo.setUserId(<span class="string">"12334445576788"</span>);</span><br><span class="line">  userLoginInfo.setUserName(<span class="string">"ZhangSan"</span>);</span><br><span class="line">  // 取得 HttpSession 对象</span><br><span class="line">  HttpSession session = request.getSession();</span><br><span class="line">  // 写入登录信息</span><br><span class="line">  session.setAttribute(<span class="string">"userLoginInfo"</span>, userLoginInfo);</span><br><span class="line">  returnData.put(<span class="string">"message"</span>, <span class="string">"login successfule"</span>);</span><br><span class="line"></span><br><span class="line">  <span class="built_in">return</span> returnData;</span><br></pre></td></tr></table></figure>

<h3 id="7-3-spring-session配置"><a href="#7-3-spring-session配置" class="headerlink" title="7.3 spring session配置"></a>7.3 spring session配置</h3><p>cookie 作为session id的载体，也可以修改属性<br>前置知识点:配置<br>spring boot 也提供了编程式的配置方式，用于配置bean</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line">@Configuration                        //在类上添加@Configuration注解，表示这是一个配置类，系统会自动扫描处理</span><br><span class="line">public class SpringHttpSessionConfig &#123;</span><br><span class="line">  @Bean                               //在方法上添加@Bean注解，表示把此方法返回的对象实例注册成bean </span><br><span class="line">  public TestBean <span class="function"><span class="title">testBean</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> new TestBean();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>session配置<br>依赖库，在pom.xml添加此依赖库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- spring session 支持 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.session&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-session-core&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
<p>配置类<br>在类上额外添加一个注解@EnableSpringHttpSession ，开启 session 。然后，注册两个 bean<br>CookieSerializer：读写Cookies中的SessionId信息<br>MapSessionRepository：Session信息在服务器上的存储仓库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.session.MapSessionRepository;</span><br><span class="line">import org.springframework.session.config.annotation.web.http.EnableSpringHttpSession;</span><br><span class="line">import org.springframework.session.web.http.CookieSerializer;</span><br><span class="line">import org.springframework.session.web.http.DefaultCookieSerializer;</span><br><span class="line"></span><br><span class="line">import java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">@EnableSpringHttpSession</span><br><span class="line">public class SpringHttpSessionConfig &#123;</span><br><span class="line">  @Bean</span><br><span class="line">  public CookieSerializer <span class="function"><span class="title">cookieSerializer</span></span>() &#123;</span><br><span class="line">    DefaultCookieSerializer serializer = new DefaultCookieSerializer();</span><br><span class="line">    serializer.setCookieName(<span class="string">"JSESSIONID"</span>);</span><br><span class="line">        // 用正则表达式配置匹配的域名，可以兼容 localhost、127.0.0.1 等各种场景</span><br><span class="line">    serializer.setDomainNamePattern(<span class="string">"^.+?\\.(\\w+\\.[a-z]+)$"</span>);</span><br><span class="line">    serializer.setCookiePath(<span class="string">"/"</span>);</span><br><span class="line">    serializer.setUseHttpOnlyCookie(<span class="literal">false</span>);</span><br><span class="line">    // 最大生命周期的单位是分钟</span><br><span class="line">    serializer.setCookieMaxAge(24 * 60 * 60);</span><br><span class="line">    <span class="built_in">return</span> serializer;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 当前存在内存中</span><br><span class="line">  @Bean</span><br><span class="line">  public MapSessionRepository <span class="function"><span class="title">sessionRepository</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> new MapSessionRepository(new ConcurrentHashMap&lt;&gt;());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="7-4-spring-request-拦截器"><a href="#7-4-spring-request-拦截器" class="headerlink" title="7.4 spring request 拦截器"></a>7.4 spring request 拦截器</h3><p>Spring 提供了 HandlerInterceptor（拦截器）解决当有大量页面页面功能需要判断用户是否登录的情况。<br>实现拦截器<br>1 创建拦截器：实现HandlerInterceptor接口，可以在三个地方进行拦截<br>一  controller方法执行之前，这是最常用的，例如：是否登录的验证就需要在preHandle()方法中处理<br>二  controller方法执行之后，例如纪录日志 统计方法执行时间等就需要在postHandle（）方法中处理<br>三  整个请求完成之后，不经常用。例如统计整个请求的执行时间的时候就需要在afterCompletion（）中处理</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import javax.servlet.http.HttpServletResponse;</span><br><span class="line"></span><br><span class="line">import org.springframework.web.servlet.HandlerInterceptor;</span><br><span class="line">import org.springframework.web.servlet.ModelAndView;</span><br><span class="line"></span><br><span class="line">public class InterceptorDemo implements HandlerInterceptor &#123;</span><br><span class="line"></span><br><span class="line">  // Controller方法执行之前</span><br><span class="line">  @Override</span><br><span class="line">  public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">    // 只有返回<span class="literal">true</span>才会继续向下执行，返回<span class="literal">false</span>取消当前请求</span><br><span class="line">    <span class="built_in">return</span> <span class="literal">true</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  //Controller方法执行之后</span><br><span class="line">  @Override</span><br><span class="line">  public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler,</span><br><span class="line">      ModelAndView modelAndView) throws Exception &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  // 整个请求完成后（包括Thymeleaf渲染完毕）</span><br><span class="line">  @Override</span><br><span class="line">  public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) </span><br><span class="line">throws Exception &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>2 实现 webmvcconfigurer<br>创建一个类实现WebMvcConfigurer，并实现 addInterceptors() 方法。这个步骤用于管理拦截器。<br>实现类上面要添加一个@Configuration 注解，让框架能自动扫描并处理。</p>
<p>管理拦截器，最重要的是设置拦截范围，常用addPathPatterns(“/**”) 表示拦截所有的 URL 。<br>也可以调用excludePathPatterns() 方法排除某些 URL，例如登录页本身就不需要登录，需要排除。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.InterceptorRegistry;</span><br><span class="line">import org.springframework.web.servlet.config.annotation.WebMvcConfigurer;</span><br><span class="line"></span><br><span class="line">@Configuration</span><br><span class="line">public class WebAppConfigurerDemo implements WebMvcConfigurer &#123;</span><br><span class="line"></span><br><span class="line">  @Override</span><br><span class="line">  public void addInterceptors(InterceptorRegistry registry) &#123;</span><br><span class="line">    // 多个拦截器组成一个拦截器链</span><br><span class="line">    // 仅演示，设置所有 url 都拦截</span><br><span class="line">    registry.addInterceptor(new UserInterceptor()).addPathPatterns(<span class="string">"/**"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通常拦截器会放在一个包里，而用于管理拦截器的配置类通常会放在另一个包。</p>
<h2 id="第八章-spring-data-入门"><a href="#第八章-spring-data-入门" class="headerlink" title="第八章 spring data 入门"></a>第八章 spring data 入门</h2><p>###8.1 专属mongodb服务器<br>mongodb是一个基于分布式文件存储的数据库，特点是可扩展，高性能为web应用提供强大的支持。<br>1 购买服务器 在滴滴云上（<a href="https://www.didiyun.com）购买服务器" target="_blank" rel="noopener">https://www.didiyun.com）购买服务器</a><br>2 登录服务器<br>执行命令</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh dc2-user@xxx.xxx.xxx.xxx  //@ 符号之后输入自己购买的云主机的公网地址</span><br></pre></td></tr></table></figure>
<p>3 安装docker<br>Docker 是近年来非常流行的虚拟化技术，这节课就不细讲了，主要用 Docker 来安装 MongoDB，自动化程度较高、非常简便。<br>使用命令行终端登录服务器后，依次输入命令（每一行是一条命令，一行输入完毕立即回车）执行：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo yum -y update</span><br><span class="line">sudo yum -y install epel-release</span><br><span class="line">sudo yum -y install docker-io</span><br></pre></td></tr></table></figure>
<p>有的同学购买的云服务器不是用 dc2-user 账户登录的，是用 root 账户登录的。 ssh root@ 登录后，输入命令可以省略掉 sudo<br>，直接输入 yum -y …… 即可。下同。<br>4 安装mongodb</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">sudo systemctl start docker</span><br><span class="line">sudo docker version                                                     //先启动docker</span><br><span class="line">sudo docker pull mongo:latest</span><br><span class="line">sudo docker images                                                      //下载镜像</span><br><span class="line">sudo docker run -itd --name mongo -p 27017:27017 mongo --auth          //启动mongodb</span><br><span class="line">sudo docker ps                                                         //检查mongodb是否启动成功</span><br><span class="line">sudo docker <span class="built_in">exec</span> -it mongo mongo admin                                //登录数据库</span><br><span class="line"></span><br><span class="line">db.createUser(&#123; user:<span class="string">'admin'</span>,<span class="built_in">pwd</span>:<span class="string">'123456'</span>,roles:[ &#123; role:<span class="string">'userAdminAnyDatabase'</span>, db: <span class="string">'admin'</span>&#125;]&#125;);</span><br><span class="line">db.auth(<span class="string">'admin'</span>, <span class="string">'123456'</span>)              //创建一个用户 admin 密码自己设置</span><br></pre></td></tr></table></figure>

<p>5创建数据库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">use practice                     //切换数据库</span><br><span class="line"></span><br><span class="line">db.createUser(&#123; user:<span class="string">'xxxx'</span>,<span class="built_in">pwd</span>:<span class="string">'xxxxxx'</span>,roles:[<span class="string">'root'</span>]&#125;); //创建读写用户</span><br><span class="line"></span><br><span class="line">db.auth(<span class="string">'xxxx'</span>, <span class="string">'xxxxxx'</span>)            //认证数据库</span><br></pre></td></tr></table></figure>

<p>6 退出登录</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<h3 id="8-2-spring-data-mongodb配置"><a href="#8-2-spring-data-mongodb配置" class="headerlink" title="8.2 spring data mongodb配置"></a>8.2 spring data mongodb配置</h3><p>pom.xml依赖<br>如果已经创建工程，可以手动添加依赖库</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-mongodb&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency</span><br></pre></td></tr></table></figure>
<p>配置</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">在src/main/resources/application.properties 文件，增加配置项：</span><br><span class="line"></span><br><span class="line"><span class="comment"># 购买的云服务器的公网 IP</span></span><br><span class="line">spring.data.mongodb.host=xxx.xxx.xxx.xxx</span><br><span class="line"><span class="comment"># MongoDB 服务的端口号</span></span><br><span class="line">spring.data.mongodb.port=27017</span><br><span class="line"><span class="comment"># 创建的数据库及用户名和密码</span></span><br><span class="line">spring.data.mongodb.database=practice</span><br><span class="line">spring.data.mongodb.username=pppp</span><br><span class="line">spring.data.mongodb.password=111aaa</span><br><span class="line">别忘了替换成自己购买的的云主机 IP 地址，以及 MongoDB 服务的用户名和密码</span><br></pre></td></tr></table></figure>

<p>云服务器安全设置：打开27017端口</p>
<h3 id="8-3-spring-data-crud"><a href="#8-3-spring-data-crud" class="headerlink" title="8.3 spring data crud"></a>8.3 spring data crud</h3><p>对数据库的操作一定要放在@Service类中，而不能放在@Controller类中。<br>@Controller 类可以调用 @Service 类的方法，反之则不行，这是 spring mvc 经典设计理念</p>
<p>@Service 类主要用于不易变的核心业务逻辑。<br>@Controller 类与前端页面紧密配合，调用 @Service 服务读写数据，从而响应前端请求，<br>1新增数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.data.mongodb.core.MongoTemplate;</span><br><span class="line"></span><br><span class="line">  @Autowired            //使用 @Autowired  注解可以让系统自动注入实例 这里为MongoTemplate实例</span><br><span class="line">  private MongoTemplate mongoTemplate;</span><br><span class="line"></span><br><span class="line">  public void <span class="function"><span class="title">test</span></span>() &#123;</span><br><span class="line">    Song song = new Song();</span><br><span class="line">    song.setSubjectId(<span class="string">"s001"</span>);</span><br><span class="line">    song.setLyrics(<span class="string">"..."</span>);</span><br><span class="line">    song.setName(<span class="string">"成都"</span>);</span><br><span class="line"></span><br><span class="line">    mongoTemplate.insert(song);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>2 查询数据</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mongoTemplate.findById(songId, Song.class)   //第一个参数为主键id 第二个参数为类名.class</span><br></pre></td></tr></table></figure>

<p>3 修改数据：修改那条数据？<br>          哪个字段修改为什么值？</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">// 修改 id=1 的数据</span><br><span class="line">Query query = new Query(Criteria.where(<span class="string">"id"</span>).is(<span class="string">"1"</span>)); //使用条件对象Criteria构建条件对象Query的实例</span><br><span class="line"></span><br><span class="line">// 把歌名修改为 “new name”</span><br><span class="line">Update updateData = new Update();                      </span><br><span class="line">updateData.set(<span class="string">"name"</span>, <span class="string">"new name"</span>);                   //调用修改对象Update的方法.<span class="built_in">set</span>()设置需要修改的字段</span><br><span class="line"></span><br><span class="line">// 执行修改，修改返回结果的是一个对象</span><br><span class="line">UpdateResult result = mongoTemplate.updateFirst(query, updateData, Song.class);  //第三个参数是具体的类</span><br><span class="line">// 修改的记录数大于 0 ，表示修改成功</span><br><span class="line">System.out.println(<span class="string">"修改的数据记录数量："</span> + result.getModifiedCount());</span><br></pre></td></tr></table></figure>

<p>4 删除数据<br>调用mongoTemplate.remove() 方法即可删除数据，参数是对象，表示需要删除哪些数据。<br>通过主键来删除数据，是比较好的方式，不容易误删</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Song song = new Song();</span><br><span class="line">song.setId(songId);</span><br><span class="line"></span><br><span class="line">// 执行删除</span><br><span class="line">DeleteResult result = mongoTemplate.remove(song);   </span><br><span class="line">// 删除的记录数大于 0 ，表示删除成功</span><br><span class="line">System.out.println(<span class="string">"删除的数据记录数量："</span> + result.getDeletedCount());</span><br></pre></td></tr></table></figure>

<h3 id="8-4-spring-data-query"><a href="#8-4-spring-data-query" class="headerlink" title="8.4 spring data query"></a>8.4 spring data query</h3><p>只根据主键查询是不能满足需求的，我们会使用多条件查询来进行复杂的查询操作</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">核心方法 </span><br><span class="line">List&lt;Song&gt; songs = mongoTemplate.find(query, Song.class);  //第一个参数 查询对象Query实例 </span><br><span class="line">                                                             第二个参数类名.class表示查询什么样的对象</span><br><span class="line"></span><br><span class="line">查询方法简单，但查询条件却十分复杂</span><br><span class="line">Query query = new Query(criteria);</span><br></pre></td></tr></table></figure>
<p>Criteria 条件对象一般有两种情况<br>1 单一条件  返回一个条件对象实例</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria1 = Criteria.where(<span class="string">"条件字段名"</span>).is(<span class="string">"条件值"</span>)</span><br></pre></td></tr></table></figure>
<p>2 组合条件 根据or或者and将多个字条件组合为复合条件<br>使用or关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">criteria.orOperator(criteria1, criteria2);</span><br></pre></td></tr></table></figure>
<p>使用and关系</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Criteria criteria = new Criteria();</span><br><span class="line">criteria.andOperator(criteria1, criteria2);</span><br></pre></td></tr></table></figure>
<p>orOperator()和andOperator()的参数，都可以输入多个子条件，也可以输入子条件数组</p>
<p>当然，组合条件下也可以多层组合，子条件也可以由组合得来</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.data.mongodb.core.query.Query;</span><br><span class="line">import org.springframework.data.mongodb.core.query.Criteria;</span><br><span class="line"></span><br><span class="line">public List&lt;Song&gt; list(Song songParam) &#123;</span><br><span class="line">    // 总条件</span><br><span class="line">    Criteria criteria = new Criteria();</span><br><span class="line">    // 可能有多个子条件</span><br><span class="line">    List&lt;Criteria&gt; subCris = new ArrayList();</span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(songParam.getName())) &#123;</span><br><span class="line">      subCris.add(Criteria.where(<span class="string">"name"</span>).is(songParam.getName()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(songParam.getLyrics())) &#123;</span><br><span class="line">      subCris.add(Criteria.where(<span class="string">"lyrics"</span>).is(songParam.getLyrics()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (StringUtils.hasText(songParam.getSubjectId())) &#123;</span><br><span class="line">      subCris.add(Criteria.where(<span class="string">"subjectId"</span>).is(songParam.getSubjectId()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 必须至少有一个查询条件</span><br><span class="line">    <span class="keyword">if</span> (subCris.isEmpty()) &#123;</span><br><span class="line">      LOG.error(<span class="string">"input song query param is not correct."</span>);</span><br><span class="line">      <span class="built_in">return</span> null;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 三个子条件以 and 关键词连接成总条件对象，相当于 name=<span class="string">''</span> and lyrics=<span class="string">''</span> and subjectId=<span class="string">''</span></span><br><span class="line">    criteria.andOperator(subCris.toArray(new Criteria[]&#123;&#125;));</span><br><span class="line"></span><br><span class="line">    // 条件对象构建查询对象</span><br><span class="line">    Query query = new Query(criteria);</span><br><span class="line">    // 仅演示：由于很多同学都在运行演示程序，所以需要限定输出，以免查询数据量太大</span><br><span class="line">    query.limit(10);</span><br><span class="line">    List&lt;Song&gt; songs = mongoTemplate.find(query, Song.class);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> songs;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="8-5-spring-data分页"><a href="#8-5-spring-data分页" class="headerlink" title="8.5 spring data分页"></a>8.5 spring data分页</h3><p>分页功能的实现十分简单，只需要调用PageRequest.of() 方法构建一个分页对象，然后注入到查询对象即可。<br>pagerequest.of（）方法第一个参数是页码，从0开始，第二个页码是每页的内容数量</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.data.domain.PageRequest;</span><br><span class="line">import org.springframework.data.domain.Pageable;</span><br><span class="line"></span><br><span class="line">Pageable pageable = PageRequest.of(0 , 20);  //第一个参数为页码，第二个参数为每页的内容数量</span><br><span class="line">query.with(pageable);</span><br></pre></td></tr></table></figure>
<p>对于分页这个操作，我们要知道总数之后，计算出一共要分多少页。所以还有两个步骤要做：<br>1 调用count(query, XXX.class)方法查询总数，第一个参数是查询条件，第二个参数表示查询什么样的对象。<br>2 根据结果，分页条件，总数三个数据，构建分页器对象。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">import org.springframework.data.domain.Page;</span><br><span class="line">import org.springframework.data.repository.support.PageableExecutionUtils;</span><br><span class="line"></span><br><span class="line">// 总数</span><br><span class="line">long count = mongoTemplate.count(query, Song.class);</span><br><span class="line">// 构建分页器</span><br><span class="line">Page&lt;Song&gt; pageResult = PageableExecutionUtils.getPage(songs, pageable, new <span class="function"><span class="title">LongSupplier</span></span>() &#123;、</span><br><span class="line">                                                //第一个参数是查询结果  第二个参数是分页条件对象  </span><br><span class="line">   第三个参数比较复杂，实现一个LongSupplier 接口的匿名类，在匿名类的 getAsLong() 方法中返回结果总数。方法返回值是一个 Page 分页器对象，</span><br><span class="line">  @Override</span><br><span class="line">  public long <span class="function"><span class="title">getAsLong</span></span>() &#123;</span><br><span class="line">    <span class="built_in">return</span> count;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2020/08/09/js%E5%9F%BA%E7%A1%80/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  js基础
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2020/08/04/java%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">
                java网络编程
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>



	<div id="vcomments"></div>


<script>
	
		// 评论
		new Valine({
			av: AV,
			el: '#vcomments',
			notify: false,
			verify: false,
			path: window.location.pathname,
			appId: '',
			appKey: '',
			placeholder: '请输入评论',
			avatar: 'retro',
			recordIP: false
		})
	
	
</script>
	</div>
	<div id="footer">
	<p>
	©2019-<span id="footerYear"></span> 
	<a href="/">John Doe</a> 
	
	
		|
		<span id="busuanzi_container_site_pv">
			pv
			<span id="busuanzi_value_site_pv"></span>
		</span>
		|
		<span id="busuanzi_container_site_uv"> 
			uv
			<span id="busuanzi_value_site_uv"></span>
		</span>
	
	<br>
	Theme <a href="//github.com/wujun234/hexo-theme-tree" target="_blank">Tree</a>
	by <a href="//github.com/wujun234" target="_blank">WuJun</a>
	Powered by <a href="//hexo.io" target="_blank">Hexo</a>
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>
	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>